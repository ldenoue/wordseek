<html lang='en'>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='black-translucent'>
<meta name='apple-mobile-web-app-title' content='WordSeek'>
<link rel='apple-touch-icon' sizes='192x192' href='icon.png'>
<link rel='icon' href='icon.png'>
<title>Cross Word Emoji</title>
<style>
@font-face {
  font-family: 'Ubuntu';
  font-style: normal;
  font-weight: 400;
  src: local('Ubuntu Regular'), local('Ubuntu-Regular'), url('ubuntu.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2212, U+2215;
}

* {
overflow:hidden;
box-sizing:content-box;
margin:0;
padding:0;
font-size:16px;
font-weight:normal;
font-family:'Ubuntu',Helvetica,monospace;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;

}

body{
background-color:#294;
user-select:none;
-webkit-touch-callout: none; /* iOS Safari */
-webkit-user-select: none; /* Safari */
background-repeat: no-repeat;
background-size: cover;
}

.highlighted { background-color: yellow;}
.word{display:inline-block;margin:8px;}
.wordicon{font-size:60px}
.wordicon > img {padding:8px}
.wordicon > img {width:80px;height:80px}
.realword{font-size:20px}

.crossed {opacity:0.5;color:#555;}

rect{
	stroke-width:0;stroke:rgb(0,0,0);
}

text{
  pointer-events:none;/* prevents it from stealing events from rects */
  font-size:36px;
  fill:black;
  opacity:1.0;
}

line{
  stroke-width:48;
}

@keyframes winAnimation {
  0%   { opacity:0; transform:scale(0.3)}
  50%  { opacity:0.5; transform:scale(1.0)}
  100% { opacity:0; transform:scale(1.3)}
}

@keyframes hintAnimation {
  0%   { opacity:0; transform:scale(0.3)}
  50%  { opacity:0.2; transform:scale(1.0)}
  100% { opacity:0; transform:scale(0.3)}
}

#hint{
  pointer-events:none;
  opacity:0;
  position:absolute;
  width:56px;height:56px;
  background-color:#2FABF9;
  border-radius:50%;
  left:8px;top:-8px;
  animation: hintAnimation 0.5s ease-out;
  animation-iteration-count: 2;
  animation-delay:0.3s;
}

#win{
  pointer-events:none;/* would steal events from grid without */
  opacity:0;
  position:absolute;
  width:128px;
  height:128px;
  background-color:white;
  border-radius:50%;
  border:0px solid white;
  font-size:48px;
  color:white;
  background-color:yellow;
  text-align:center;
  line-height:128px;
}

.zoom{animation: winAnimation 0.9s ease-out}

#grid{
padding:0px;
height:400px;
max-height:calc(100vw - 64px);
max-width:calc(100vw - 64px);
border:0px solid blue;
border-radius:0px;
background-color:transparent;
transition: opacity 1s ease-in-out;
}

#container{
width:100vw;height:100%;
position:fixed;
left:0px;
top:0px;
display:flex;
flex-direction:column;
align-items: center;
text-align:center;
justify-content: space-evenly;
}

.item{align-self:center}

#header{
  position:fixed;
  width:100vw;
  top:0px;
  left:0px;
  margin:0px;
  padding:0;
  font-size:22px;
}
#totalwordsdiv{float:left;padding:8px;}
#highscorediv{float:right;padding:8px;}

.solutionrect { opacity:0.9; transition: opacity 1s ease-in-out}

#help{
  cursor:pointer;
  font-size:22px;
  position:fixed;
  right:2;
  bottom:2;
}

#reset{
  cursor:pointer;
  font-size:22px;
  position:fixed;
  left:2;
  bottom:2;
}

@media only screen and (orientation:landscape) {
  #container{flex-direction:row;}
  .word{display:block;}
  .wordicon{font-size:48px;}
  .wordicon > img {width:48px;height:48px}
  .realword{font-size:18px;}
  #grid{
    max-height:calc(100vh - 64px);
    height:400px;
    max-width:calc(100vh - 64px);
  }
}

@media only screen and (orientation:landscape) and (min-width:800px) {
  .wordicon{font-size:80px;}
  .wordicon > img {width:80px;height:80px}
}

@media only screen and (max-width:400px) {
  .wordicon{font-size:40px}
  .wordicon > img {width:40px;height:40px}
  .realword{font-size:16px}
  #grid{height:400px;max-width:calc(100vw-32px);max-height:calc(100vw-32px))}
}

@media only screen and (min-width:800px) and (min-height:800px) {
    .wordicon{font-size:120px}
    .wordicon > img {width:120px;height:120px}
    .realword{font-size:32px}
    #totalwordsdiv,#highscorediv{font-size:32px;}
    #grid{height:640px;max-width:calc(100vw-32px);max-height:calc(100vw-32px))}
}
td{font-family:monospace}
</style>
</head>
<body onload='init()'>
<div id='container'>
  <svg class='item' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xml:space='preserve' id='grid'></svg>
</div>
<div id='win'>1</div>
<div id='header'><div id='totalwordsdiv'>0 words</div><div id='highscorediv'>0 points</div></div>
<div id='hint'></div>
<script>
'use strict';
var useTwitterEmoji = false;
var HORIZONTAL = 0;
var VERTICAL = 1;
var lastSelection = null;

// full list at https://emojipedia.org/nature/
var emojis={All:{
  Grapes:"ğŸ‡",Melon:"ğŸˆ",Watermelon:"ğŸ‰",Tangerine:"ğŸŠ",Lemon:"ğŸ‹",Banana:"ğŸŒ",Pineapple:"ğŸ",
  Apple:"ğŸ",Apple:"ğŸ",Pear:"ğŸ",Peach:"ğŸ‘",Cherries:"ğŸ’",
  Strawberry:"ğŸ“",Kiwi:"ğŸ¥",Tomato:"ğŸ…",Coconut:"ğŸ¥¥",Avocado:"ğŸ¥‘",Eggplant:"ğŸ†",
  Potato:"ğŸ¥”",Carrot:"ğŸ¥•",Corn:"ğŸŒ½",Pepper:"ğŸŒ¶",Cucumber:"ğŸ¥’",Broccoli:"ğŸ¥¦",
  Mushroom:"ğŸ„",Peanuts:"ğŸ¥œ",Chestnut:"ğŸŒ°",Bread:"ğŸ",Croissant:"ğŸ¥",Baguette:"ğŸ¥–",
  Pretzel:"ğŸ¥¨",Pancakes:"ğŸ¥",Cheese:"ğŸ§€",Meat:"ğŸ–",Poultry:"ğŸ—",Meat:"ğŸ¥©",Bacon:"ğŸ¥“",Hamburger:"ğŸ”",
  Fries:"ğŸŸ",Pizza:"ğŸ•","Hot Dog":"ğŸŒ­",Sandwich:"ğŸ¥ª",Taco:"ğŸŒ®",Burrito:"ğŸŒ¯",Cooking:"ğŸ³",Pot:"ğŸ²",Bowl:"ğŸ¥£",
  Salad:"ğŸ¥—",Popcorn:"ğŸ¿",Can:"ğŸ¥«",Bento:"ğŸ±",Cracker:"ğŸ˜",Rice:"ğŸš",Curry:"ğŸ›",Bowl:"ğŸœ",Spaghetti:"ğŸ",
  Potato:"ğŸ ",Sushi:"ğŸ£",Shrimp:"ğŸ¤",Dumpling:"ğŸ¥Ÿ",Cookie:"ğŸ¥ ",Box:"ğŸ¥¡","IceCream":"ğŸ¦",
  Doughnut:"ğŸ©",Cookie:"ğŸª",Cake:"ğŸ‚",Shortcake:"ğŸ°",Pie:"ğŸ¥§",Chocolate:"ğŸ«",
  Candy:"ğŸ¬",Lollipop:"ğŸ­",Custard:"ğŸ®",Honey:"ğŸ¯",Bottle:"ğŸ¼",
  Milk:"ğŸ¥›",Beverage:"â˜•",Teacup:"ğŸµ",Sake:"ğŸ¶",Cork:"ğŸ¾",Wine:"ğŸ·",Cocktail:"ğŸ¸",Drink:"ğŸ¹",Beer:"ğŸº",
  Mug:"ğŸ»",Glasses:"ğŸ¥‚",Glass:"ğŸ¥ƒ",Straw:"ğŸ¥¤",Chopsticks:"ğŸ¥¢",Plate:"ğŸ½",Fork:"ğŸ´",Spoon:"ğŸ¥„",
  Monkey:"ğŸ™‰",Collision:"ğŸ’¥",Droplets:"ğŸ’¦",Dizzy:"ğŸ’«",Monkey:"ğŸµ",Monkey:"ğŸ’",Gorilla:"ğŸ¦",Dog:"ğŸ¶",Dog:"ğŸ•",
  Poodle:"ğŸ©",Wolf:"ğŸº",Fox:"ğŸ¦Š",Cat:"ğŸ±",Cat:"ğŸˆ",Lion:"ğŸ¦",Tiger:"ğŸ¯",Tiger:"ğŸ…",Leopard:"ğŸ†",
  Horse:"ğŸ´",Horse:"ğŸ",Unicorn:"ğŸ¦„",Zebra:"ğŸ¦“",Cow:"ğŸ®",Ox:"ğŸ‚",Buffalo:"ğŸƒ",Cow:"ğŸ„",Pig:"ğŸ·",
  Pig:"ğŸ–",Boar:"ğŸ—",Pig:"ğŸ½",Ram:"ğŸ",Ewe:"ğŸ‘",Goat:"ğŸ",Camel:"ğŸª",Camel:"ğŸ«",Giraffe:"ğŸ¦’",
  Elephant:"ğŸ˜",Rhinoceros:"ğŸ¦",Mouse:"ğŸ­",Mouse:"ğŸ",Rat:"ğŸ€",Hamster:"ğŸ¹",Rabbit:"ğŸ°",
  Rabbit:"ğŸ‡",Chipmunk:"ğŸ¿",Hedgehog:"ğŸ¦”",Bat:"ğŸ¦‡",Bear:"ğŸ»",Koala:"ğŸ¨",Panda:"ğŸ¼",Paw:"ğŸ¾",
  Turkey:"ğŸ¦ƒ",Chicken:"ğŸ”",Rooster:"ğŸ“",Chick:"ğŸ£",Chick:"ğŸ¤",Chick:"ğŸ¥",Bird:"ğŸ¦",Penguin:"ğŸ§",Dove:"ğŸ•Š",
  Eagle:"ğŸ¦…",Duck:"ğŸ¦†",Owl:"ğŸ¦‰",Frog:"ğŸ¸",Crocodile:"ğŸŠ",Turtle:"ğŸ¢",Lizard:"ğŸ¦",Snake:"ğŸ",Dragon:"ğŸ²",
  Dragon:"ğŸ‰",Sauropod:"ğŸ¦•",Trex:"ğŸ¦–",Whale:"ğŸ³",Whale:"ğŸ‹",Dolphin:"ğŸ¬",Fish:"ğŸŸ",Fish:"ğŸ ",Blowfish:"ğŸ¡",
  Shark:"ğŸ¦ˆ",Octopus:"ğŸ™",Shell:"ğŸš",Crab:"ğŸ¦€",Shrimp:"ğŸ¦",Squid:"ğŸ¦‘",Snail:"ğŸŒ",Butterfly:"ğŸ¦‹",
  Bug:"ğŸ›",Ant:"ğŸœ",Honeybee:"ğŸ",Beetle:"ğŸ",Cricket:"ğŸ¦—",Spider:"ğŸ•·",Web:"ğŸ•¸",Scorpion:"ğŸ¦‚",
  Bouquet:"ğŸ’",Blossom:"ğŸŒ¸",Rosette:"ğŸµ",Rose:"ğŸŒ¹",Flower:"ğŸ¥€",Hibiscus:"ğŸŒº",Flower:"ğŸŒ¼",Tulip:"ğŸŒ·",
  Seedling:"ğŸŒ±",Tree:"ğŸŒ²",Deciduous:"ğŸŒ³",Palm:"ğŸŒ´",Cactus:"ğŸŒµ",Rice:"ğŸŒ¾",Herb:"ğŸŒ¿",Shamrock:"â˜˜",
  Clover:"ğŸ€",Maple:"ğŸ",Leaf:"ğŸ‚",Leaf:"ğŸƒ",Mushroom:"ğŸ„",Chestnut:"ğŸŒ°",Moon:"ğŸŒ•",Moon:"ğŸŒœ",Sun:"ğŸŒ",
  Star:"â­",Cloud:"â›…",Tornado:"ğŸŒª",
  Rainbow:"ğŸŒˆ",Umbrella:"â˜‚",Drops:"â˜”",
  Snowman:"â›„",Comet:"â˜„",Fire:"ğŸ”¥",Droplet:"ğŸ’§",
  Tree:"ğŸ„",Sparkles:"âœ¨",Tanabata:"ğŸ‹",Pine:"ğŸ",Baby:"ğŸ‘¶",Angel:"ğŸ‘¼",SantaClaus:"ğŸ…",Elf:"ğŸ§",
  Socks:"ğŸ§¦",Deer:"ğŸ¦Œ",Cookie:"ğŸª",Milk:"ğŸ¥›",Wine:"ğŸ·",Fork:"ğŸ´",Church:"â›ª",Star:"ğŸŒŸ",Snowflake:"â„",
  Snowman:"â›„",Fire:"ğŸ”¥",Tree:"ğŸ„",Gift:"ğŸ",Bell:"ğŸ””",Notes:"ğŸ¶",Candle:"ğŸ•¯",Smiling:"ğŸ˜",Snowboarder:"ğŸ‚",
  Evergreen:"ğŸŒ²",Mountain:"ğŸ”",
  Wind:"ğŸŒ¬",
  Umbrella:"ğŸŒ‚",
  Rain:"â˜”",Snowflake:"â„",Snowman:"â›„",Skis:"ğŸ¿",Horse:"ğŸ‡",Skier:"â›·",Snowboarder:"ğŸ‚",
  Surfing:"ğŸ„",Rowing:"ğŸš£",Boat:"ğŸš£",Swimming:"ğŸŠ",Bouncing:"â›¹",Weights:"ğŸ‹",Biking:"ğŸš´",
  Wrestling:"ğŸ¤¼",
  Handball:"ğŸ¤¾",Juggling:"ğŸ¤¹",Circus:"ğŸª",Ribbon:"ğŸ—",Ticket:"ğŸ«",Medal:"ğŸ–",
  Trophy:"ğŸ†",Medal:"ğŸ…",Soccer:"âš½",Basketball:"ğŸ€",Volleyball:"ğŸ",Football:"ğŸˆ",Rugby:"ğŸ‰",Tennis:"ğŸ¾",
  Bowling:"ğŸ³",Cricket:"ğŸ",Hockey:"ğŸ‘",Hockey:"ğŸ’","Ping Pong":"ğŸ“",Badminton:"ğŸ¸",Boxing:"ğŸ¥Š",
  Skating:"â›¸",
  Fishing:"ğŸ£",
  Skis:"ğŸ¿",Sled:"ğŸ›·",Pool:"ğŸ±",Die:"ğŸ²",Palette:"ğŸ¨",Score:"ğŸ¼",Microphone:"ğŸ¤",Headphone:"ğŸ§",
  Saxophone:"ğŸ·",Guitar:"ğŸ¸",Keyboard:"ğŸ¹",Trumpet:"ğŸº",Violin:"ğŸ»",Drum:"ğŸ¥",Clapper:"ğŸ¬",Bow:"ğŸ¹",
  Rowing:"ğŸš£",Racing:"ğŸ",Motorcycle:"ğŸ",Mountain:"ğŸ”",Fountain:"â›²",Volcano:"ğŸŒ‹",Fuji:"ğŸ—»",
  Camping:"ğŸ•",Beach:"ğŸ–",Desert:"ğŸœ",Island:"ğŸ",
  Stadium:"ğŸŸ",Building:"ğŸ›",Construction:"ğŸ—",Houses:"ğŸ˜",
  House:"ğŸ ",
  Office:"ğŸ¢","Post Office":"ğŸ¤",
  Hospital:"ğŸ¥",Bank:"ğŸ¦",Hotel:"ğŸ¨",Store:"ğŸª",School:"ğŸ«",Factory:"ğŸ­",Castle:"ğŸ°",Wedding:"ğŸ’’",
  Liberty:"ğŸ—½",Church:"â›ª",Mosque:"ğŸ•Œ",Synagogue:"ğŸ•",Kaaba:"ğŸ•‹",Tent:"â›º",
  Carousel:"ğŸ ","Wheel":"ğŸ¡",Roller:"ğŸ¢",
  Locomotive:"ğŸš‚",Railway:"ğŸšƒ",Train:"ğŸš„",Train:"ğŸš…",Train:"ğŸš†",Metro:"ğŸš‡",Rail:"ğŸšˆ",
  Tram:"ğŸšŠ",Monorail:"ğŸš",Railway:"ğŸš",Tram:"ğŸš‹",Bus:"ğŸšŒ",Trolleybus:"ğŸš",Minibus:"ğŸš",Ambulance:"ğŸš‘",
  Fire:"ğŸš’",Police:"ğŸš“",Taxi:"ğŸš•",Taxi:"ğŸš–",Automobile:"ğŸš—",Automobile:"ğŸš˜",Truck:"ğŸšš",Lorry:"ğŸš›",Tractor:"ğŸšœ",
  Bicycle:"ğŸš²",Scooter:"ğŸ›´",Scooter:"ğŸ›µ",
  Fuel:"â›½",Light:"ğŸš¦",Construction:"ğŸš§",Anchor:"âš“",Sailboat:"â›µ",Speedboat:"ğŸš¤",Ship:"ğŸ›³",Ferry:"â›´",Boat:"ğŸ›¥",
  Ship:"ğŸš¢",Airplane:"ğŸ›©",Seat:"ğŸ’º",Helicopter:"ğŸš",Cableway:"ğŸš ",Tramway:"ğŸš¡",Satellite:"ğŸ›°",Rocket:"ğŸš€",
  Saucer:"ğŸ›¸",
  Umbrella:"â›±",
  Yen:"ğŸ’´",Dollar:"ğŸ’µ",Euro:"ğŸ’¶",Pound:"ğŸ’·",Moai:"ğŸ—¿",
  "Smiling":"ğŸ˜€","Joy":"ğŸ˜‚","Laughing":"ğŸ¤£","Sweat":"ğŸ˜…","Squinting":"ğŸ˜†","Winking":"ğŸ˜‰",
  Savoring:"ğŸ˜‹",Sunglasses:"ğŸ˜",Kiss:"ğŸ˜˜",Hugging:"ğŸ¤—",Thinking:"ğŸ¤”",Eyebrow:"ğŸ¤¨",Rolling:"ğŸ™„",Smirking:"ğŸ˜",
  Persevering:"ğŸ˜£",Relieved:"ğŸ˜¥",Sleepy:"ğŸ˜ª",Tired:"ğŸ˜«",Sleeping:"ğŸ˜´",Relieved:"ğŸ˜Œ",Tongue:"ğŸ˜›",
  Drooling:"ğŸ¤¤",Pensive:"ğŸ˜”",Confused:"ğŸ˜•",Astonished:"ğŸ˜²",Disappointed:"ğŸ˜",Worried:"ğŸ˜Ÿ",
  Ogre:"ğŸ‘¹",Goblin:"ğŸ‘º",Skull:"ğŸ’€",Ghost:"ğŸ‘»",Alien:"ğŸ‘½",Robot:"ğŸ¤–",Poo:"ğŸ’©",
  Biceps:"ğŸ’ª",Index:"ğŸ‘ˆ",Horns:"ğŸ¤˜",Hand:"âœ‹",OK:"ğŸ‘Œ",Thumbs:"ğŸ‘",Fist:"âœŠ",Waving:"ğŸ‘‹",Clapping:"ğŸ‘",
  Handshake:"ğŸ¤",Nail:"ğŸ’…",Ear:"ğŸ‘‚",Nose:"ğŸ‘ƒ",Footprints:"ğŸ‘£",Eyes:"ğŸ‘€",Eye:"ğŸ‘",Brain:"ğŸ§ ",Tongue:"ğŸ‘…",Mouth:"ğŸ‘„",
  Glasses:"ğŸ‘“",Sunglasses:"ğŸ•¶",Necktie:"ğŸ‘”",TShirt:"ğŸ‘•",Jeans:"ğŸ‘–",Scarf:"ğŸ§£",Gloves:"ğŸ§¤",Coat:"ğŸ§¥",Socks:"ğŸ§¦",
  Dress:"ğŸ‘—",Kimono:"ğŸ‘˜",Bikini:"ğŸ‘™",Purse:"ğŸ‘›",Handbag:"ğŸ‘œ",Backpack:"ğŸ’",Shoe:"ğŸ‘",Shoe:"ğŸ‘Ÿ",
  Sandal:"ğŸ‘¡",Boot:"ğŸ‘¢",Crown:"ğŸ‘‘",Hat:"ğŸ‘’",Cap:"ğŸ“",Helmet:"â›‘",Lipstick:"ğŸ’„",Ring:"ğŸ’",Umbrella:"ğŸŒ‚",
  Briefcase:"ğŸ’¼",
  Bath:"ğŸ›€",Bed:"ğŸ›Œ",Bomb:"ğŸ’£",Hole:"ğŸ•³",Bags:"ğŸ›",Gem:"ğŸ’",Knife:"ğŸ”ª",
  Amphora:"ğŸº",Map:"ğŸ—º",Drum:"ğŸ›¢",Bell:"ğŸ›",Hourglass:"âŒ›",Watch:"âŒš",Alarm:"â°",Stopwatch:"â±",Timer:"â²",
  Thermometer:"ğŸŒ¡",Umbrella:"â›±",Balloon:"ğŸˆ",Popper:"ğŸ‰",Dolls:"ğŸ",Ribbon:"ğŸ€",Gift:"ğŸ",Crystal:"ğŸ”®",
  Joystick:"ğŸ•¹",Picture:"ğŸ–¼",Microphone:"ğŸ™",Radio:"ğŸ“»",Phone:"ğŸ“±",Telephone:"ğŸ“",Pager:"ğŸ“Ÿ",Fax:"ğŸ“ ",
  Battery:"ğŸ”‹",Plug:"ğŸ”Œ",Laptop:"ğŸ’»",Computer:"ğŸ–¥",Printer:"ğŸ–¨",Keyboard:"âŒ¨",Mouse:"ğŸ–±",Trackball:"ğŸ–²",Disk:"ğŸ’½",
  Floppy:"ğŸ’¾",DVD:"ğŸ“€",Camera:"ğŸ¥",Projector:"ğŸ“½",Television:"ğŸ“º",Camera:"ğŸ“·",
  Videocassette:"ğŸ“¼",
  Magnifying:"ğŸ”",Candle:"ğŸ•¯",Bulb:"ğŸ’¡",Flashlight:"ğŸ”¦",Lantern:"ğŸ®",Notebook:"ğŸ“”",Book:"ğŸ“•",Books:"ğŸ“š",Notebook:"ğŸ““",
  Page:"ğŸ“ƒ",Scroll:"ğŸ“œ",Newspaper:"ğŸ—",Bookmark:"ğŸ”–",Label:"ğŸ·",Money:"ğŸ’°",
  CreditCard:"ğŸ’³",Envelope:"ğŸ“©",Package:"ğŸ“¦",Mailbox:"ğŸ“«",Postbox:"ğŸ“®",Pencil:"âœ",Pen:"ğŸ–Š",Paintbrush:"ğŸ–Œ",Crayon:"ğŸ–",
  Memo:"ğŸ“",
  Folder:"ğŸ“",Calendar:"ğŸ“…",Notepad:"ğŸ—’",Chart:"ğŸ“ˆ",BarChart:"ğŸ“Š",Clipboard:"ğŸ“‹",
  Pushpin:"ğŸ“Œ",
  Paperclip:"ğŸ“",Ruler:"ğŸ“",Scissors:"âœ‚",Cabinet:"ğŸ—„",Wastebasket:"ğŸ—‘",Locked:"ğŸ”’",Unlocked:"ğŸ”“",
  Key:"ğŸ”‘",Hammer:"ğŸ”¨",Pick:"â›",Dagger:"ğŸ—¡",Pistol:"ğŸ”«",Shield:"ğŸ›¡",Wrench:"ğŸ”§",Bolt:"ğŸ”©",Gear:"âš™",Clamp:"ğŸ—œ",
  Scale:"âš–",Link:"ğŸ”—",Chains:"â›“",Alembic:"âš—",Microscope:"ğŸ”¬",Telescope:"ğŸ”­",Satellite:"ğŸ“¡",Syringe:"ğŸ’‰",Pill:"ğŸ’Š",
  Door:"ğŸšª",Bed:"ğŸ›",Couch:"ğŸ›‹",Toilet:"ğŸš½",Shower:"ğŸš¿",Bathtub:"ğŸ›",Cigarette:"ğŸš¬",
  Moai:"ğŸ—¿",Flag:"ğŸ",
  Golfing:"ğŸŒ"
  }
};
var score = 0;
var totalWords = 0;
var startEvent = 'mousedown';
var endEvent = 'mouseup';
var moveEvent = 'mousemove';
var outEvent = 'mouseleave';
var isMouseDown = false;
var backColor = null;
var isNewGame = false;
var bgColors = '#2FABF9,#F2C03A,#DB2E29,#9280F9'.split(',');
var hiColors = 'yellow,#3BDB29,#2FABF9,#F2C03A,#DB2E29,#9280F9'.split(',');
var currentColor = 0;
var letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
var points = {"a":1,"b":3,"c":3,"d":2,"e":1,"f":4,"g":2,"h":4,"i":1,"j":8,"k":5,"l":1,"m":3,"n":1,"o":1,"p":3,"q":10,"r":1,"s":1,"t":1,"u":1,"v":4,"w":4,"x":8,"y":4,"z":10};
var words_emojis = [];
var gamew = 9;
var gameh = 9;
var nQuestions = 6;
var nFound = 0;
var matrix = new Array(gameh);
var first = null;
var solution = new Array();

var categories = Object.keys(emojis);
var words = [];
var found_words = [];
var category = categories[0];
var names = Object.keys(emojis[category]);

function $(id)
{
	return document.getElementById(id);
}

function rnd(n)
{
	return Math.floor(Math.random()*n);
}

function goodPos(x,y,word,direction)
{
  if (direction === HORIZONTAL)
  {
    for (var i=x;i<x+word.length+1;i++)
    {
      if (matrix[y][i] != ' ')
        return false;
    }
  	return true;
  }
  else if (direction === VERTICAL)
  {
    for (var j=y;j<y+word.length+1;j++)
    {
      if (matrix[j][x] != ' ')
        return false;
    }
  	return true;
  }
}

function placeWord(x,y,w,emoji,direction)
{
  if (direction === HORIZONTAL)
  {
  	matrix[y][x] = emoji;
    for (var i=x;i<x+w.length;i++)
    {
      matrix[y][i+1] = w.charAt(i-x);
    }
  	solution[w] = {x1:x,y1:y,x2:x+w.length-1,y2:y};
  }
  else if (direction === VERTICAL)
  {
  	matrix[y][x] = emoji;
    for (var j=y;j<y+w.length;j++)
    {
      matrix[j+1][x] = w.charAt(j-y);
    }
    solution[w] = {x1:x,y1:y,x2:x,y2:y+w.length-1};
  }
}

function highlightSelection(x1,y1,x2,y2)
{
  lastSelection = [x1,y1,x2,y2];
  selectionline.setAttribute('x1',x1*48+24);
  selectionline.setAttribute('y1',y1*48+24);
  selectionline.setAttribute('x2',x2*48+24);
  selectionline.setAttribute('y2',y2*48+24);
}

function showWin(n,x1,y1,x2,y2)
{
  var pos = getPosition((x1+x2+1)/2,(y1+y2)/2);
  pos.x -= win.offsetWidth / 2;
  pos.y -= win.offsetHeight / 2;
  pos.x |= 0;
  pos.y |= 0;
  win.style.left = pos.x + 'px';
  win.style.top = pos.y + 'px';
  win.textContent = '+' + n;
  win.classList.add('zoom');
  setTimeout(function () { win.classList.remove('zoom')},900);
}

function checkWord(coords)
{
  var x1 = coords[0];
  var y1 = coords[1];
  var x2 = coords[2];
  var y2 = coords[3];
  if (x1 > x2)
    return checkWord([x2,y2,x1,y1]);
  if (y1 > y2)
    return checkWord([x2,y2,x1,y1]);
  first = null;
  var textselection = '';
  if (y1 === y2)
  {
    for (var x=x1;x<=x2;x++)
      textselection += matrix[y1][x];
  }
  else if (x1 === x2)
  {
    for (var y=y1;y<=y2;y++)
      textselection += matrix[y][x1];
  }
  else
  {
    var y = y1;
    for (var x=x1;x<=x2;x++)
    {
      textselection += matrix[y][x];
      y++;
    }
  }
  var found = -1;
  if (found_words.indexOf(textselection) !== -1)
  {
    return;
  }
  for (var i=0;i<words.length;i++)
  {
    if (textselection === words[i])
    {
      found = i;
      break;
    }
  }
  if (found >= 0)
  {
    found_words.push(textselection);
    var lineSolution = document.querySelector('#solutionrect' + found);
    lineSolution.dataset.done = 'true';
    lineSolution.setAttribute('x1',x1*48+24);
    lineSolution.setAttribute('y1',y1*48+24);
    lineSolution.setAttribute('x2',x2*48+24);
    lineSolution.setAttribute('y2',y2*48+24);
    lineSolution.style.visibility = 'visible';

    first = null;
    nFound++;
    var points = pointsForWord(textselection);
    score += points;
    setScore(score);
    showWin(points,x1,y1,x2,y2);
    totalWords++;
    setTotalWords(totalWords);
    if (nFound === words.length)
    {
      var rects = document.querySelectorAll('.solutionrect');
      rects.forEach(r => r.style.opacity = 0);
      isNewGame = true;
      setTimeout(function () {init()},1000);
    }
  }
  else
  {
  }
}

function setScore(s)
{
  try {
    window.localStorage.score = s;
  } catch (e) {}
  if (s > 1)
    highscorediv.textContent = score + ' points';
  else
    highscorediv.textContent = score + ' point';
}

function setTotalWords(s)
{
  try {
    window.localStorage.totalWords = s;
  } catch (e) {}
  if (s > 1)
    totalwordsdiv.textContent = totalWords + ' words';
  else
    totalwordsdiv.textContent = totalWords + ' word';
}

function pointsForWord(textselection)
{
  var pts = 0;
  if (!textselection)
    return 0;
  var letters = textselection.trim().toLowerCase().split('');
  for (var i=0;i<letters.length;i++)
  {
    var val = points[letters[i]];
    if (val)
      pts += val;
  }
  return pts;
}

function reHint()
{
  var newone = hint.cloneNode(true);
  hint.parentNode.replaceChild(newone, hint);
}

function init()
{
  nFound = 0;
  var elems = document.querySelectorAll('.letter');
  elems.forEach(a => delete a.dataset.done);

  currentColor = parseInt(Math.random() * hiColors.length);
  backColor = bgColors[new Date%bgColors.length];
  document.body.style.backgroundColor = backColor;
	words = [];
	found_words = [];
	words_emojis = [];
	var n = 0;
	while (n < 1000 && words.length < nQuestions)
	{
	  n++;
    var idx = parseInt(Math.random()*names.length);
	  var name = names[idx];
	  if (name.length < gamew && name.length < gameh && name.indexOf(' ') === -1 && name.indexOf('-') !== 0 && words.indexOf(name.toUpperCase()) === -1)
	  {
      var emoji = emojis[category][name];
      var up = name.toUpperCase();
      /*var found = words.length === 0;
      for (var i=0;!found && i<words.length;i++)
      {
        for (var j=0;j<up.length;j++)
        {
          if (words[i].indexOf(up[j]) !== -1)
          {
            found = true;
            console.log(words[i],up);
            break;
          }
        }
      }
      if (!found)
        break;*/
      words.push(up);
      if (useTwitterEmoji)
      {
        var hexcode = hexCodeFromEmoji(emoji);
        words_emojis.push('<img src="svg/' + hexcode + '.svg">');
      }
      else
        words_emojis.push(emoji);
    }
	}
	solution = [];
	initReal();
}

function hexCodeFromEmoji(emoji)
{
  var code = emoji.charCodeAt(0);
  if (emoji.length > 2)
    console.error('emoji > 3',emoji);
  if (emoji.length === 2)
  {
    code = (
            0x10000
            | ((emoji.charCodeAt(0) - 0xD800) << 10)
            | (emoji.charCodeAt(1) - 0xDC00)
        );
  }
  var hexcode = code.toString(16);
  return hexcode;
}

var GRID_WIDTH = 9;
var GRID_HEIGHT = 9;
var EMPTYCHAR = ' ';
var FIT_ATTEMPTS = 500;
var topScore = 0;
var coordCount = 0;
var coordList = [];
var wordArray = [
  {word:'toto',clue:'toto'},
  {word:'titi',clue:'toto'},
];
function board(cols, rows) { //instantiator object for making gameboards
this.cols = cols;
this.rows = rows;
var activeWordList = []; //keeps array of words actually placed in board
var acrossCount = 0;
var downCount = 0;

var grid = new Array(cols); //create 2 dimensional array for letter grid
for (var i = 0; i < rows; i++) {
    grid[i] = new Array(rows);
}

for (var x = 0; x < cols; x++) {
    for (var y = 0; y < rows; y++) {
        grid[x][y] = {};
        grid[x][y].targetChar = EMPTYCHAR; //target character, hidden
        grid[x][y].indexDisplay = ''; //used to display index number of word start
        grid[x][y].value = '-'; //actual current letter shown on board
    }
}

function suggestCoords(word) { //search for potential cross placement locations
    var c = '';
    coordCount = [];
    coordCount = 0;
    for (i = 0; i < word.length; i++) { //cycle through each character of the word
        for (x = 0; x < GRID_HEIGHT; x++) {
            for (y = 0; y < GRID_WIDTH; y++) {
                c = word[i];
                if (grid[x][y].targetChar == c) { //check for letter match in cell
                    if (x - i + 1> 0 && x - i + word.length-1 < GRID_HEIGHT) { //would fit vertically?
                        coordList[coordCount] = {};
                        coordList[coordCount].x = x - i;
                        coordList[coordCount].y = y;
                        coordList[coordCount].score = 0;
                        coordList[coordCount].vertical = true;
                        coordCount++;
                    }

                    if (y - i + 1 > 0 && y - i + word.length-1 < GRID_WIDTH) { //would fit horizontally?
                        coordList[coordCount] = {};
                        coordList[coordCount].x = x;
                        coordList[coordCount].y = y - i;
                        coordList[coordCount].score = 0;
                        coordList[coordCount].vertical = false;
                        coordCount++;
                    }
                }
            }
        }
    }
}

function checkFitScore(word, x, y, vertical) {
    var fitScore = 1; //default is 1, 2+ has crosses, 0 is invalid due to collision

    if (vertical) { //vertical checking
        for (i = 0; i < word.length; i++) {
            if (i == 0 && x > 0) { //check for empty space preceeding first character of word if not on edge
                if (grid[x - 1][y].targetChar != EMPTYCHAR) { //adjacent letter collision
                    fitScore = 0;
                    break;
                }
            } else if (i == word.length && x < GRID_HEIGHT) { //check for empty space after last character of word if not on edge
                 if (grid[x+i+1][y].targetChar != EMPTYCHAR) { //adjacent letter collision
                    fitScore = 0;
                    break;
                }
            }
            if (x + i < GRID_HEIGHT) {
                if (grid[x + i][y].targetChar == word[i]) { //letter match - aka cross point
                    fitScore += 1;
                } else if (grid[x + i][y].targetChar != EMPTYCHAR) { //letter doesn't match and it isn't empty so there is a collision
                    fitScore = 0;
                    break;
                } else { //verify that there aren't letters on either side of placement if it isn't a crosspoint
                    if (y < GRID_WIDTH - 1) { //check right side if it isn't on the edge
                        if (grid[x + i][y + 1].targetChar != EMPTYCHAR) { //adjacent letter collision
                            fitScore = 0;
                            break;
                        }
                    }
                    if (y > 0) { //check left side if it isn't on the edge
                        if (grid[x + i][y - 1].targetChar != EMPTYCHAR) { //adjacent letter collision
                            fitScore = 0;
                            break;
                        }
                    }
                }
            }

        }

    } else { //horizontal checking
        for (i = 0; i < word.length; i++) {
            if (i == 0 && y > 0) { //check for empty space preceeding first character of word if not on edge
                if (grid[x][y-1].targetChar != EMPTYCHAR) { //adjacent letter collision
                    fitScore = 0;
                    break;
                }
            } else if (i == word.length - 1 && y + i < GRID_WIDTH -1) { //check for empty space after last character of word if not on edge
                if (grid[x][y + i + 1].targetChar != EMPTYCHAR) { //adjacent letter collision
                    fitScore = 0;
                    break;
                }
            }
            if (y + i < GRID_WIDTH) {
                if (grid[x][y + i].targetChar == word[i]) { //letter match - aka cross point
                    fitScore += 1;
                } else if (grid[x][y + i].targetChar != EMPTYCHAR) { //letter doesn't match and it isn't empty so there is a collision
                    fitScore = 0;
                    break;
                } else { //verify that there aren't letters on either side of placement if it isn't a crosspoint
                    if (x < GRID_HEIGHT) { //check top side if it isn't on the edge
                        if (grid[x + 1][y + i].targetChar != EMPTYCHAR) { //adjacent letter collision
                            fitScore = 0;
                            break;
                        }
                    }
                    if (x > 0) { //check bottom side if it isn't on the edge
                        if (grid[x - 1][y + i].targetChar != EMPTYCHAR) { //adjacent letter collision
                            fitScore = 0;
                            break;
                        }
                    }
                }
            }

        }
    }

    return fitScore;
}

function placeWord(word, clue, x, y, vertical) { //places a new active word on the board

    var wordPlaced = false;

    if (vertical) {
        if (word.length + x < GRID_HEIGHT) {
            for (i = 0; i < word.length; i++) {
                grid[x + i][y].targetChar = word[i];
            }
            wordPlaced = true;
        }
    } else {
        if (word.length + y < GRID_WIDTH) {
            for (i = 0; i < word.length; i++) {
                grid[x][y + i].targetChar = word[i];
            }
            wordPlaced = true;
        }
    }

    if (wordPlaced) {
        var currentIndex = activeWordList.length;
        activeWordList[currentIndex] = {};
        activeWordList[currentIndex].word = word;
        activeWordList[currentIndex].clue = clue;
        activeWordList[currentIndex].x = x;
        activeWordList[currentIndex].y = y;
        activeWordList[currentIndex].vertical = vertical;

        if (activeWordList[currentIndex].vertical) {
            downCount++;
            activeWordList[currentIndex].number = downCount;
        } else {
            acrossCount++;
            activeWordList[currentIndex].number = acrossCount;
        }
    }

}

function isActiveWord(word) {
    if (activeWordList.length > 0) {
        for (var w = 0; w < activeWordList.length; w++) {
            if (word == activeWordList[w].word) {
                //console.log(word + ' in activeWordList');
                return true;
            }
        }
    }
    return false;
}

this.displayGrid = function displayGrid() {

    for (var x = 0; x < cols; x++) {
        for (var y = 0; y < rows; y++) {
            matrix[y][x] = grid[x][y].targetChar;
        }
    }
    return acrossCount + downCount;
}

//for each word in the source array we test where it can fit on the board and then test those locations for validity against other already placed words
this.generateBoard = function generateBoard(seed = 0) {

    var bestScoreIndex = 0;
    var top = 0;
    var fitScore = 0;
    var startTime;

    //manually place the longest word horizontally at 0,0, try others if the generated board is too weak
    placeWord(wordArray[seed].word, wordArray[seed].clue, 0, 0, false);

    //attempt to fill the rest of the board 
    for (var iy = 0; iy < FIT_ATTEMPTS; iy++) { //usually 2 times is enough for max fill potential
        for (var ix = 1; ix < wordArray.length; ix++) {
            if (!isActiveWord(wordArray[ix].word)) { //only add if not already in the active word list
                topScore = 0;
                bestScoreIndex = 0;

                suggestCoords(wordArray[ix].word); //fills coordList and coordCount
                //coordList = shuffleArray(coordList); //adds some randomization

                if (coordList[0]) {
                    for (var c = 0; c < coordList.length; c++) { //get the best fit score from the list of possible valid coordinates
                        fitScore = checkFitScore(wordArray[ix].word, coordList[c].x, coordList[c].y, coordList[c].vertical);
                        if (fitScore > topScore) {
                            topScore = fitScore;
                            bestScoreIndex = c;
                        }
                    }
                }

                if (topScore > 1) { //only place a word if it has a fitscore of 2 or higher

                    placeWord(wordArray[ix].word, wordArray[ix].clue, coordList[bestScoreIndex].x, coordList[bestScoreIndex].y, coordList[bestScoreIndex].vertical);
                }
            }

        }
    }
    if(activeWordList.length < wordArray.length/2) { //regenerate board if if less than half the words were placed
        seed++;
        generateBoard(seed);
    }
}
}

var gameboard;

function seedBoard() {
    gameboard = new board(GRID_WIDTH, GRID_HEIGHT);
    gameboard.generateBoard();
    return gameboard.displayGrid();
}


function initReal()
{
	for (var j=0;j<gameh;j++)
	{
		matrix[j] = new Array(gamew);
		for (var i=0;i<gamew;i++)
		{
			matrix[j][i] = ' ';
		}
	}

	wordArray = [];
	for (var i=0;i<words.length;i++)
	{
	  wordArray.push({word:words[i],clue:''});
	}
	for (var i=0;i<300;i++)
	{
	  var n = seedBoard();
	  if (n >= 3)
	    break;
	  }

  var size = gamew * 48;
  
	var html = '';
  var color = 0;
  var solutionid = 0;
	for (var w in solution)
	{
	  var x1 = 48 * solution[w].x1+24;
	  var y1 = 48 * solution[w].y1+24;
    var x2 = 48 * solution[w].x2+24;
    var y2 = 48 * solution[w].y2+24;
	  var fillColor = hiColors[color%hiColors.length];
    html += '<line class="solutionrect" id=solutionrect' + solutionid + ' stroke-linecap="round" style="visibility:hidden;stroke:' + fillColor + '" x1=' + x1 + ' y1=' + y1 + ' x2=' + x2 + ' y2=' + y2 + ' />';
	  color++;
	  solutionid++;
	}
  html += '<line id="selectionline" x1="0" y1="0" x2="200" y2="200" stroke-linecap="round" style="visibility:hidden;stroke:rgb(255,255,0)" />';
	for (var j=0;j<gameh;j++)
	{
		for (var i=0;i<gamew;i++)
		{
			if (matrix[j][i] === ' ')
				continue;
			var letter = (matrix[j][i] >= 'A' && matrix[j][i] <= 'Z');
			
      if (letter)
      {
				html += '<rect fill="white" id=cell' + j + '_'+ i + ' data-i='+ i + ' data-j=' + j + ' class="letter" width="46px" height="46px" x="' + (i * 48+1) + '" y="' + (j * 48+1) + '" />';
	      html += '<text text-anchor="middle" alignment-baseline="middle" x="' + (i * 48+24) + '" y="' + (j * 48+28) + '">' + matrix[j][i] + '</text>';
	    }
	    else
	    {
		    html += '<rect fill="transparent" id=cell' + j + '_'+ i + ' data-i='+ i + ' data-j=' + j + ' class="letter" width="46px" height="46px" x="' + (i * 48) + '" y="' + (j * 48) + '" />';
	    	html += '<text style="font-size:44px" text-anchor="middle" alignment-baseline="middle" x="' + (i * 48+24) + '" y="' + (j * 48+28) + '">' + matrix[j][i] + '</text>';
	    }
		}
	}
	grid.innerHTML = html;
	grid.setAttribute('viewBox','0 0 ' + size + ' ' + size);

  win.style.backgroundColor = backColor;

  grid.style.opacity = 1.0;
  reHint();
}


function solve()
{
  var solutions = document.querySelectorAll('.solutionrect');
  solutions.forEach(s => s.style.visibility = 'visible');
}

function unsolve()
{
  var solutions = document.querySelectorAll('.solutionrect');
  solutions.forEach(s => {if (!s.dataset.done) s.style.visibility = 'hidden'});
}

if ('ontouchstart' in document.documentElement)
{
  startEvent = 'touchstart';
  endEvent = 'touchend';
  outEvent = 'touchleave';
  moveEvent = 'touchmove';
}

function getPosition(x,y) {
  var rect = grid.getBoundingClientRect();
  return {
    x:rect.left + rect.width * x / gamew,
    y:rect.top + rect.height * y / gameh
  };
}

document.body.addEventListener(startEvent,function (){init();});

grid.addEventListener(moveEvent, function (e) {
  e.preventDefault();
  if (first === null)
    return;
  var elem = null;
  if (moveEvent === 'mousemove')
  {
    if (!isMouseDown)
      return;
    elem = document.elementFromPoint(e.clientX,e.clientY);
  }
  else
  {
    var clientX = e.touches[0].clientX;
    var clientY = e.touches[0].clientY;
    elem = document.elementFromPoint(clientX,clientY);  
  }
  if (first && elem.classList.contains('letter') && elem.dataset.done !== 'true')
  {
    var x1 = first.x;
    var y1 = first.y;
    var x2 = +elem.dataset.i;
    var y2 = +elem.dataset.j;
    var dx = Math.abs(x2 - x1);
    var dy = Math.abs(y2 - y1);
    if (dx > dy && dy <= 2)
      highlightSelection(x1,y1,x2,y1); // horizontal
    else if (dy > dx && dx <= 2)
      highlightSelection(x1,y1,x1,y2); // vertical
    else if (dx === dy)
      highlightSelection(x1,y1,x2,y2); // diagonal
  }
});

grid.addEventListener(endEvent,function(e) {
  isMouseDown = false;
  if (lastSelection)
    checkWord(lastSelection);
  selectionline.style.visibility = 'hidden';
  lastSelection = null;
});

grid.addEventListener('mouseleave',function(e) {
  isMouseDown = false;
  selectionline.style.visibility = 'hidden';
  lastSelection = null;
});

grid.addEventListener(startEvent, function (e) {
  e.preventDefault();
  e.stopImmediatePropagation();
  isMouseDown = true;
  var cell = e.target;
  if (cell.classList.contains('letter') && cell.dataset.done !== 'true')
  {
    first = {x:+cell.dataset.i,y:+cell.dataset.j}; 
    selectionline.style.visibility = 'visible';
    highlightSelection(first.x,first.y,first.x,first.y);
  }
});

totalwordsdiv.addEventListener(startEvent,function(e){
  e.preventDefault();
  e.stopPropagation();
  solve();
});

totalwordsdiv.addEventListener(endEvent,function(e){
  e.preventDefault();
  e.stopPropagation();
  unsolve();
});

totalwordsdiv.addEventListener(outEvent,function(e){
  e.preventDefault();
  e.stopPropagation();
  unsolve();
});

highscorediv.addEventListener(endEvent,function(e){
  e.preventDefault();
  e.stopPropagation();
  score = 0;
  totalWords = 0;
  setScore(score);
  setTotalWords(totalWords);
});

highscorediv.addEventListener(startEvent,function(e){
  e.preventDefault();
  e.stopPropagation();
});

try {
  if (window.localStorage && window.localStorage.score)
    score = +window.localStorage.score;
  if (window.localStorage && window.localStorage.totalWords)
    totalWords = +window.localStorage.totalWords;
} catch (e) {}

setScore(score);
setTotalWords(totalWords);
</script>
</body>
</html>
